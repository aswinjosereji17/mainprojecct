{% extends 'user_prof.html' %}

{% load static %}
{% block content %}

<head>
  <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  
  {% comment %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Shopping Cart</title>
  <!-- Include Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <!-- Include Bootstrap JS (Popper.js and Bootstrap JS) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  {% endcomment %}

</head>
<style>

</style>

<body>
  <!-- Breadcrumb Start -->
  <div class="container-fluid">
    <div class="row px-xl-5">
      <div class="col-12">
        <nav class="breadcrumb bg-light mb-30">
          <a class="breadcrumb-item text-dark" href="#">Home</a>
          <!-- <a class="breadcrumb-item text-dark" href="#">Shop</a> -->
          <span class="breadcrumb-item active">Shopping Cart</span>
        </nav>
      </div>
    </div>
  </div>
  <!-- Breadcrumb End -->


  <!-- Cart Start -->



  <div style="height: auto;" class="container-fluid">
    <div class="row px-xl-5 justify-content-center"> <!-- Center the row horizontally -->
      {% if cart %}
      {% if cart_items|length == 0 %}
      <div class="container text-center mt-5">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card border-0 shadow">
              <div class="card-body p-5">
                <h1 class="display-4">Your Aqueon Cart is Empty</h1>
                <p class="lead">Explore our amazing products and add some to your cart!</p>
                <a href="{% url 'index' %}" class="btn btn-primary btn-lg">Browse Products</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      {% endif %}
      <!-- Left Column: Cart Items -->
      <div class="col-lg-8 table-responsive mb-5 mx-auto"> <!-- Center the left column -->

        {% for item in cart_items %}

        <div class="container mt-4">
          <div class="">
            <div class="col-md-8">
              <div class="card">
                <div class="card-item"> <!-- Apply the row class here -->
                  <!-- Left: Product Image -->
                  <img style="max-height: 280px; width: 280px; height:220px; border-radius: 6px; margin-left:30px"
                    src="{{ item.prod.productdescription.img1.url }}" class="mr-3 img-fluid" alt="Product Image">
                  <div class="media-body">
                    <!-- Product Name -->
                    <h5 class="mt-0"><b>{{ item.prod.prod_name }}</b></h5>
                    <!-- Price -->
                    <!-- <p> Rs.{{ item.prod.price }}</p> -->
<!-- Update the Total Price display -->









<p id="total_price_{{ item.cart_item_id }}"> Total Price: Rs.{{ item.total_price }}</p>




<!-- Quantity -->
                    
                    <button style="width:25px; border-radius: 5px; background-color:#FFD333; border:none; outline:none;" type="button" onclick="decrementValue()">-</button>
                    <input style="text-align:center;  width:30px; border:none; outline:none;" type="number" id="quantity" name="quantity" value="{{ item.quantity }}" min="1" required oninput="calculateTotalPrice()">
                    <button style="width:25px; border-radius: 5px; background-color:#FFD333; border:none; outline:none;" type="button" onclick="incrementValue()">+</button>


                    <!-- <script>
                      function incrementValue() {
                      var input = document.getElementById('quantity');
                      var value = parseInt(input.value, 10);
                      value = isNaN(value) ? 1 : value + 1; // Increment the value (minimum value is 1)
                      input.value = value;
                      calculateTotalPrice(); // Recalculate total when quantity changes
                  }
                  
                  function decrementValue() {
                      var input = document.getElementById('quantity');
                      var value = parseInt(input.value, 10);
                      value = isNaN(value) ? 1 : (value > 1 ? value - 1 : 1); // Decrement the value (minimum value is 1)
                      input.value = value;
                      calculateTotalPrice(); // Recalculate total when quantity changes
                  }
                  
                  </script> -->



                    <!-- <p>Quantity: {{ item.quantity }}</p> -->
                  <!-- </div> -->
                  <!-- <div style="margin-top:3px;"> -->
                    <!-- In Stock Status --></br></br>
                    {% if item.prod.stock_quantity == 0 %}
                    <button style="border: none; border-radius: 5px; background-color:red;height:25px;">
                      <p style="color: white;">Out of Stock</p>
                    </button>
                    {% else %}
                    <button style="border: none; border-radius: 5px; background-color:green; height:30px;">
                      <p style="color: white;">In Stock</p>
                    </button>
                    {% endif %}


                    <!-- Update the Quantity input field to include data attributes -->
<input style="text-align:center; width:30px; border:none; outline:none;"
type="number" id="quantity_{{ item.cart_item_id }}"
name="quantity" value="{{ item.quantity }}"
data-price="{{ item.prod.price }}"
min="1" required oninput="calculateTotalPrice({{ item.cart_item_id }})">




<script>
  function calculateTotalPrice(cartItemId) {
      // Retrieve quantity and price from the input field and data attribute
      const quantity = document.getElementById(`quantity_${cartItemId}`).value;
      const price = document.getElementById(`quantity_${cartItemId}`).dataset.price;

      // Perform the calculation
      const totalPrice = quantity * price;

      // Update the total price display
      const totalPriceTag = document.getElementById(`total_price_${cartItemId}`);
      totalPriceTag.innerText = `Total Price: Rs.${totalPrice}`;

      // Send an AJAX request to update the server-side data
      const url = "{% url 'update_cart_item' %}";

      // Use Fetch API to send a POST request
      fetch(url, {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}',
          },
          body: JSON.stringify({
              cartItemId: cartItemId,
              quantity: quantity,
          }),
      })
      .then(response => response.json())
      .then(data => console.log(data))
      .catch(error => console.error('Error:', error));
  }
</script>



                  <!-- </div> -->
                  <!-- <div> --></br></br>
                    <form method="post" action="{% url 'remove_cart_item' item.cart_item_id %}">
                  <!-- </div> -->
                  {% csrf_token %}
                  <button style="border-radius: 5px; background-color:red; margin-top:9px;" type="submit" class="btn btn-sm btn-danger">
                    <i class="bi bi-trash"> Remove</i>
                  </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- <p>Your cart is empty. (Cart items count: {{ cart_items|length }})</p> -->
      {% endfor %}
      {% endif %}

      {% comment %} {% else %}
      <p>Your cart is empty. (Cart items count: {{ cart_items|length }})</p>
      {% endif %} {% endcomment %}
    </div>
    {% if cart_items|length > 0 %}
    <!-- Right Column: Coupon and Checkout -->
    <div style=" margin-top: 30px;" class="col-lg-4 mx-auto"> <!-- Center the right column -->
      {% comment %} <form class="mb-30" action="">
        <div class="input-group">
          <input type="text" class="form-control border-0 p-4" placeholder="Coupon Code">
          <div class="input-group-append">
            <button class="btn btn-primary">Apply Coupon</button>
          </div>
        </div>
      </form> {% endcomment %}
      <h5 class="section-title position-relative text-uppercase mb-3"><span
          style="color:#DAA520;  -webkit-text-stroke: 0.5px gray; display: inline-block;" class=""><b>Cart
            Summary</b></span></h5>
      <div class="bg-light p-30 mb-5">
        <div class="border-bottom pb-2">
          <div class="d-flex justify-content-between mb-3">
            <h6>Subtotal</h6>
            <h6>Rs. {{ total_cart_value|default:"0.00" }}</h6>
          </div>
          <div class="d-flex justify-content-between">
            <h6 class="font-weight-medium">Shipping</h6>
            {% if cart_items|length == 0 %}
            <h6 class="font-weight-medium">Rs.0.00</h6>{% else %}

            <h6 class="font-weight-medium">Rs.50</h6> {% endif %}
          </div>
        </div>
        <div class="pt-2">
          <div class="d-flex justify-content-between mt-2">
            <h5>Total</h5>
            {% if cart_items|length == 0 %}
            <h6 class="font-weight-medium">Rs.0.00</h6>
            {% else %}
            <h5>Rs. {{ multiplied_value|floatformat:2 }}</h5>{% endif %}
          </div>
          <form action="{% url 'homepage' %}">
          <button id="pay-btn" type="submit" class="btn btn-block btn-primary font-weight-bold my-3 py-3">Proceed To Checkout</button>
        </form>
        </div>
      </div>
    </div>



   



    {% endif %}

  </div>
  </div>
</body>
<!-- Cart End -->

{% endblock %}