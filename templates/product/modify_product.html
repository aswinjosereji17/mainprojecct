{% extends 'user_prof.html' %}


{% block content %}
<script>
    $(document).ready(function () {
      // Function to validate the price input
      function validatePrice() {
        var priceInput = parseFloat($("#price").val());
        if (isNaN(priceInput) || priceInput <= 0) {
          $("#price-error").text("Price must be greater than 0.");
          return false;
        } else {
          $("#price-error").text("");
          return true;
        }
      }

      // Attach the validation function to the form submission
      $(".product_mod").submit(function () {
        return validatePrice();
      });

      // Attach the validation function to the price input's change event
      $("#price").change(validatePrice);

    });
  </script>

<style>
    input[type="text"],
    input[type="number"],
    select,
    textarea,
    #sub_categ,
    #description,
    #instruction {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #9cc7e3; /* Red border color */
        border-radius: 5px;
        font-size: 16px;
        width: 500px;
    }

    #description,
    #instruction{
        height: 150px;
    }

    #img1_preview,
    #img2_preview,
    #img3_preview{
        width: 200px;
        height: 200px;
    }
    
   
</style>


    <h1>Modify Product</h1>
   <form method="post" enctype="multipart/form-data" class="product_mod">
    {% csrf_token %}
    <div class="mb-3">
        <label for="prod_name" class="form-label">Product Name:</label>
        <input type="text" id="prod_name" name="prod_name" value="{{ product.prod_name }}" class="form-control" style="width: 500px;">
    </div>
    
    <div class="mb-3">
        <label for="price" class="form-label">Price:</label>
        <input type="number" step="0.01" id="price" name="price" value="{{ product.price }}" class="form-control" >
        <span id="price-error" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label for="quantity" class="form-label">Quantity:</label>
        <input type="number" min="0" id="quantity" name="quantity" value="{{ product.stock_quantity }}" class="form-control" >
        <span id="quantity-error" class="text-danger"></span>
    </div>

    
    <div class="mb-3">
        <label for="sub_categ" class="form-label">Subcategory:</label>
        <select id="sub_categ" name="sub_categ_id" class="form-select" >
            {% for subcategory in subcategories %}
                <option value="{{ subcategory.sub_cat_id }}" {% if subcategory.sub_cat_id == product.sub_categ_id.sub_cat_id %}selected{% endif %}>
                    {{ subcategory.sub_cat_name }}
                </option>
            {% endfor %}
        </select>
    </div>
    
    <div class="mb-3">
        <label for="description" class="form-label">Description:</label>
        <textarea id="description" name="description" class="form-control" required>{{ description.description }}</textarea>
    </div>

    <div class="mb-3">
        <label for="instruction" class="form-label">Instructions:</label>
        <textarea id="instruction" name="instruction" class="form-control" required>{{ description.instructions }}</textarea>
    </div>
    
    <div class="mb-3">
        <label for="img1" class="form-label">Image 1:</label>
        <input type="file" id="img1" name="img1" onchange="viewImage1(event)" accept="image/*" class="form-control-file">
        <input type="hidden" name="img1_current" value="{{ description.img1.url }}">
        {% if description.img1 %}
            <img id="img1_preview" src="{{ description.img1.url }}" alt="Image 1"><br><br>
        {% else %}
            <img id="img1_preview" style=" display: none;">
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="img2" class="form-label">Image 2:</label>
        <input type="file" id="img2" name="img2" onchange="viewImage2(event)" accept="image/*" class="form-control-file">
        <input type="hidden" name="img2_current" value="{{ description.img2.url }}">
        {% if description.img2 %}
            <img id="img2_preview"  src="{{ description.img2.url }}" alt="Image 2"><br><br>
        {% else %}
            <img id="img2_preview" style=" display: none;">
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="img3" class="form-label">Image 3:</label>
        <input type="file" id="img3" name="img3" onchange="viewImage3(event)" accept="image/*" class="form-control-file">
        <input type="hidden" name="img3_current" value="{{ description.img3.url }}">
        {% if description.img3 %}
            <img id="img3_preview"  src="{{ description.img3.url }}" alt="Image 3"><br><br>
        {% else %}
            <img id="img3_preview" style=" display: none;">
        {% endif %}
    </div>
    
    <div class="mb-3">
        <input type="submit" value="Save Changes" class="btn btn-primary">
    </div>
</form>

    
    <br>
    <a href="{% url 'product_list' %}">Back to Product List</a>

    <script>
        function viewImage1(event){
            document.getElementById('img1_preview').src=URL.createObjectURL(event.target.files[0])
        }
        function viewImage2(event){
            document.getElementById('img2_preview').src=URL.createObjectURL(event.target.files[0])
        }
        function viewImage3(event){
            document.getElementById('img3_preview').src=URL.createObjectURL(event.target.files[0])
        }
    </script>

{% endblock%}