{% extends 'index.html' %}

{% load static %}
{% block content_mainn %}

<head>

    <script>
        function calculateTotalPricee() {
            // Get the quantity input element and the total price input element
            var quantityInput = document.getElementById('quantity');
            var totalPriceInput = document.getElementById('t_price');

            // Get the price per item (you may need to fetch this from your server)
            var pricePerItem = {{ products.price }
        };

        // Calculate the total price based on quantity and price per item
        var quantity = parseInt(quantityInput.value);
        var total = quantity * pricePerItem;

        // Update the total price input field with the calculated total
        totalPriceInput.value = total.toFixed(2); // Display the total with 2 decimal places
        }

        function incrementValue() {
            var quantityInput = document.getElementById('quantity');
            var currentQuantity = parseInt(quantityInput.value);
            var stockQuantity = {{ products.stock_quantity }
        };  // Use the actual stock quantity from your Django model

        if (currentQuantity < stockQuantity) {
            quantityInput.value = currentQuantity + 1;
            calculateTotalPricee(); // Recalculate total when quantity changes
        }
}

        function decrementValue() {
            var quantityInput = document.getElementById('quantity');
            var currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
                calculateTotalPricee(); // Recalculate total when quantity changes
            }
        }

        // Call calculateTotalPrice initially
        calculateTotalPricee();
    </script>

</head>
<style>
    #d_img {
        max-width: 100%;
        /* Ensure the image doesn't exceed its container's width */
        height: 500px;
        /* Allow the height to adjust proportionally to the width */
    }

    /* Media query for screens narrower than 700px */
    @media (max-width: 700px) {
        #d_img {
            width: 100%;
            /* Set the image width to 100% to fit the container */
            height: auto;
            /* Allow the height to adjust proportionally to the width */
        }
    }


    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        appearance: none;
        margin: 0;
    }

    /* Style to remove border and outline */
    input[type="number"] {
        border: none;
        outline: none;
        text-align: center;
        width: 30px;
    }
</style>

<!-- Shop Detail Start -->
<div class="container-fluid pb-5">
    <div class="row px-xl-5">
        <div class="col-lg-5 mb-30">
            <div id="product-carousel" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner bg-light">
                    <div class="carousel-item active">
                        <img id="d_img" class="w-100 h-100" src="{{ products.productdescription.img1.url }}"
                            alt="Image">
                    </div>
                    <div class="carousel-item">
                        <img id="d_img" class="w-100 h-100" src="{{ products.productdescription.img2.url }}"
                            alt="Image">
                    </div>
                    <div class="carousel-item">
                        <img id="d_img" class="w-100 h-100" src="{{ products.productdescription.img3.url }}"
                            alt="Image">
                    </div>
                    <!-- <div class="carousel-item">
                            <img class="w-100 h-100" src="img/product-4.jpg" alt="Image">
                        </div> -->
                </div>
                <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
                    <i class="fa fa-2x fa-angle-left text-dark"></i>
                </a>
                <a class="carousel-control-next" href="#product-carousel" data-slide="next">
                    <i class="fa fa-2x fa-angle-right text-dark"></i>
                </a>
            </div>
        </div>



        {% comment %} <h1>Add to Cart</h1> {% endcomment %}

        {% comment %} <form method="post" action="{% url 'add_to_cart' %}">
            {% csrf_token %}

            <!-- Input for product ID -->
            <label for="prod_id">Product ID:</label>
            <input type="text" id="prod_id" name="prod_id" value="{{products.prod_id}}" required>

            <!-- Input for quantity -->
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" value="1" min="1" required>

            <button type="submit">Add to Cart</button>
        </form> {% endcomment %}
        <div class="col-lg-7 h-auto mb-30">

            <form method="post" action="{% url 'add_to_cart' %}">
                {% csrf_token %}
                <input type="hidden" id="prod_id" name="prod_id" value="{{products.prod_id}}" required>
                <div class="h-100 bg-light p-30">
                    <h3>{{ products.prod_name }}</h3>

                    <div class="d-flex mb-3">
                        <div class="d-flex align-items-center justify-content-center mb-1">
                            {% if avg_rating <= 5 and avg_rating >= 4.1 %}
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            {% elif avg_rating <= 4 and avg_rating >= 3.1 %}
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-secondary mr-1"></small>
                            {% elif avg_rating <= 3 and avg_rating >= 2.1 %}
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-success mr-1"></small>
                            <small class="fa fa-star text-secondary mr-1"></small>
                            <small class="fa fa-star text-secondary mr-1"></small>
                            {% elif avg_rating <= 2 and avg_rating >= 1.1 %}
                            <small class="fa fa-star text-danger mr-1"></small>
                            <small class="fa fa-star text-danger mr-1"></small>
                            <small class="fa fa-star text-secondary mr-1"></small>
                            <small class="fa fa-star text-secondary mr-1"></small>
                            <small class="fa fa-star text-secondary mr-1"></small>
                            {% elif avg_rating <= 1 %} <small class="fa fa-star text-danger mr-1"></small>
                                <small class="fa fa-star text-secondary mr-1"></small>
                                <small class="fa fa-star text-secondary mr-1"></small>
                                <small class="fa fa-star text-secondary mr-1"></small>
                                <small class="fa fa-star text-secondary mr-1"></small>
                                {% endif %}
                                <!-- <small>({{ avg_rating }})</small> -->
                        </div>

                        <!-- <small class="pt-1">(99 Reviews)</small> -->

                    </div>
                    <h3 class="font-weight-semi-bold mb-4">Rs.{{ products.price }}</h3>
                    {% if products.stock_quantity == 0 %}
                    <p style="color: red;">Out of Stock</p>
                    {% else %}
                    <p style="color: green;">In Stock</p>
                    {% endif %}

                    <div class="d-flex align-items-center mb-4 pt-2">
                        {% comment %} <div class="input-group quantity mr-3" style="width: 130px;">

                            <div class="input-group-btn">

                            </div>
                            <div style="display: flex; flex-direction: row; gap: 10px;">
                                <div style="height: 25px; width: 25px; border-radius: 5px; color: black; background-color: #FFD333; text-align: center;"
                                    onmouseover="this.style.cursor='pointer';" onmouseout="this.style.cursor='default';"
                                    onclick="decrementValue()">-</div>
                                <div>
                                    <!-- <input style="text-align:center;  width:30px; border:none; outline:none;" type="number" id="quantity" name="quantity" value="1" min="1" required> -->
                                    <input style="text-align:center;  width:30px; border:none; outline:none;"
                                        type="number" id="quantity" name="quantity" value="1" min="1" required
                                        oninput="calculateTotalPricee()">
                                </div>
                                <div style="height: 25px; width: 25px; border-radius: 5px; color: black; background-color: #FFD333; text-align: center;"
                                    onclick="incrementValue()" onmouseover="this.style.cursor='pointer';"
                                    onmouseout="this.style.cursor='default';">+</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 20px; margin-top: 15px;">

                                <p style="margin: 0;">Total</p>
                                <p style="margin: 0; ">Amount:</p>

                                <input id="t_price" style=" margin: 0; text-align:center;  border:none; outline:none;"
                                    type="text" disabled>
                            </div>
                        </div> {% endcomment %}

                        <div class="input-group-btn">

                        </div>
                    </div>
                    {% if products.stock_quantity == 0 %}
                    <button style="border-radius: 5px;" type="submit" class="btn btn-primary px-3" disabled><i
                            class="fa fa-shopping-cart mr-1"></i> Add To Cart</button>
                    {% else %}
                    <button style="border-radius: 5px;" type="submit" class="btn btn-primary px-3"><i
                            class="fa fa-shopping-cart mr-1"></i> Add To Cart</button>
                    {% endif %}
                    <!-- 
                    <script>
                        function incrementValuee() {
                            var input = document.getElementById('quantity');
                            var value = parseInt(input.value, 10);
                            value = isNaN(value) ? 1 : value + 1; // Increment the value (minimum value is 1)
                            input.value = value;
                            calculateTotalPrice(); // Recalculate total when quantity changes
                        }

                        function decrementValuee() {
                            var input = document.getElementById('quantity');
                            var value = parseInt(input.value, 10);
                            value = isNaN(value) ? 1 : (value > 1 ? value - 1 : 1); // Decrement the value (minimum value is 1)
                            input.value = value;
                            calculateTotalPrice(); // Recalculate total when quantity changes
                        }

                    </script> -->

                    {% comment %}
                    <script>
                        // Get the input element
                        var inputElement = document.querySelector(".quantity input");

                        // Get the plus and minus buttons
                        var minusButton = document.querySelector(".btn-minus");
                        var plusButton = document.querySelector(".btn-plus");

                        // Add click event listeners to the plus and minus buttons
                        minusButton.addEventListener("click", function () {
                            var value = parseInt(inputElement.value);
                            if (value > 1) {
                                inputElement.value = value - 1;
                            }
                        });

                        plusButton.addEventListener("click", function () {
                            var value = parseInt(inputElement.value);
                            inputElement.value = value + 1;
                        });
                    </script> {% endcomment %}
            </form>
        </div>

        {% comment %} <div class="d-flex pt-2">
            <strong class="text-dark mr-2">Share on:</strong>
            <div class="d-inline-flex">
                <a class="text-dark px-2" href="">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a class="text-dark px-2" href="">
                    <i class="fab fa-twitter"></i>
                </a>
                <a class="text-dark px-2" href="">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a class="text-dark px-2" href="">
                    <i class="fab fa-pinterest"></i>
                </a>
            </div>
        </div> {% endcomment %}
        </form>

    </div>
</div>
</div>
<div class="row px-xl-5">
    <div class="col">
        <div class="bg-light p-30">
            <div class="nav nav-tabs mb-4">
                <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Description</a>
                <!-- <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Instructions</a> -->
                <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-3">Reviews</a>
            </div>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-pane-1">

                    <div class="row">
                        <div class="col-md-6">
                            <!-- <h4 class="mb-4">{{ reviews|length }} reviews for "{{ reviews.product.prod_name }}"</h4> -->
                            <div class="media mb-4">
                                <!-- <img src="img/user.jpg" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;"> -->
                                <div class="media-body">
                                    <h4 class="mb-3">Product Description</h4>

                                    <textarea style="width: 812px; height: 300px; border: none; overflow-y: scroll; scrollbar-width: none; -ms-overflow-style: none; text-align: justify;" disabled>{{ prod_desc.description }}</textarea>
                                </div>
                            </div>
                        </div>
<style>
    .custom-file-upload {
    display: inline-block;
    position: relative;
    cursor: pointer;
    padding-left: 6px;
    /* padding: 10px; */
    border: 1px solid #ccc;
    border-radius: 5px;
}

.custom-file-upload input {
    display: none;
}

.custom-file-upload i {
    margin-right: 5px;
}

</style>
<style>
    #suggestions {
        display: none;
        position: absolute;
        border: 1px solid #ccc;
        max-height: 100px;
        overflow-y: auto;
        background-color: #fff;
    }

    #suggestions ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }

    #suggestions li {
        padding: 8px;
        cursor: pointer;
    }

    #suggestions li:hover {
        background-color: #f0f0f0;
    }
    #suggestions {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

#suggestions::-webkit-scrollbar {
    display: none;
}

</style>

                        <div class="col-md-6">
                            <h4 class="mb-4">About the fish:</h4>
                            <div class="d-flex my-3">
                                <form id="question-form" method="POST" enctype="multipart/form-data" action="{% url 'homeee' products.prod_id %}">
                                    {% csrf_token %}
                                    <div style="display: flex; flex-direction: row; gap: 18px;" class="form-group">
                                        <!-- <label for="message">Question :</label> -->
                                        <textarea style="height: 45px;" id="message" name="description" cols="30" rows="5" class="form-control" required></textarea>

    <div style="margin-top: 44px; width: 283px;" id="suggestions">
        <ul id="suggestion-list"></ul>
    </div>
    <script>
        const textarea = document.getElementById('message');
        const suggestionsContainer = document.getElementById('suggestions');
        const suggestionList = document.getElementById('suggestion-list');

        const suggestions = ['ph level of this fish?', 'identify the fish from photo', 'how often clean the tank',];

        textarea.addEventListener('input', function () {
            const inputValue = textarea.value.toLowerCase();
            const filteredSuggestions = suggestions.filter(suggestion =>
                suggestion.toLowerCase().includes(inputValue)
            );

            displaySuggestions(filteredSuggestions);
        });

        function displaySuggestions(suggestionArray) {
            suggestionList.innerHTML = '';

            if (suggestionArray.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }

            suggestionArray.forEach(suggestion => {
                const listItem = document.createElement('li');
                listItem.textContent = suggestion;

                listItem.addEventListener('click', function () {
                    textarea.value = suggestion;
                    suggestionsContainer.style.display = 'none';
                });

                suggestionList.appendChild(listItem);
            });

            suggestionsContainer.style.display = 'block';
        }

        document.addEventListener('click', function (event) {
            if (event.target !== textarea) {
                suggestionsContainer.style.display = 'none';
            }
        });
    </script>
                                            <label for="upload-image" class="custom-file-upload">
                                                <input type="file" id="upload-image" name="upload-image" accept="image/*">
                                                <i style="font-size:30px;" class="bi bi-upload"></i> 
                                            </label>
                                    </div>
                                    <div class="form-group mb-0">
                                        <input type="submit" value="Ask Question" class="btn btn-primary px-3">
                                    </div>
                                </form>
                                <button style="margin-left: 20px; background-color: white; border: none; height: 40px; width: 40px; margin-top: 0px;" id="voice-button" class=""><i style="font-size:30px;" class="bi bi-mic"></i></button>
                                <!-- <form action="/ml" method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="file" name="upload-image" accept="image/*">
                                    <button type="submit">Upload image</button>
                                </form> -->
                               

                            </div>

                            <div id="response-container">
                                <div id="loading-message" style="display: none;"><div class="lds-hourglass"></div></div>
                                <div id="similar-fish-section" style="display: none;">
                                    <h4 class="mb-3">Similar Fish Species:</h4>
                                    <ul id="similar-fish-list"></ul>
                                </div>
                                <div id="predicted-answer-section" style="display: none;">
                                    <h4 class="mb-3">Solution :</h4>
                                    <p id="predicted-answer-label"></p>
                                </div>
                                <!-- Add a container for image predicted answer -->
                                <div id="image-predicted-answer-section" style="display: none;">
                                    <h4 class="mb-3">Identified fishes :</h4>
                                    <p id="img_predicted-answer-label"></p>
                                    <img style="width: 500px; height: 500px;" id="predicted-image"  alt="Predicted Image">
                                    <!-- Add the necessary HTML to display the image predicted answer -->
                                </div>
                                <div id="no-similarity-message" style="display: none;">No image found</div>
                            </div>
                            

                        </div>
                        <div id="response-container">
                            <div id="loading-message" style="display: none;">Loading...</div>
                            <div id="similar-fish-section" style="display: none;">
                                <h4 class="mb-3">Similar Fish Species:</h4>
                                <ul id="similar-fish-list"></ul>
                            </div>
                            <div id="predicted-answer-section" style="display: none;">
                                <h4 class="mb-3">Predicted Answer:</h4>
                                <p id="predicted-answer-label"></p>
                            </div>
                            <div id="no-similarity-message" style="display: none;">No similarity found</div>
                        </div>
                    </div>

                    <script>
                        $(document).ready(function () {
                            $("#question-form").submit(function (event) {
            event.preventDefault();  // Prevent the form from submitting in the traditional way

            var form = $(this);
            var formData = new FormData(form[0]);  // Use FormData to handle file uploads

            // Display loading message
            $("#loading-message").show();
            $("#similar-fish-section, #predicted-answer-section, #image-predicted-answer-section, #no-similarity-message").hide();

            $.ajax({
                type: form.attr("method"),
                url: form.attr("action"),
                data: formData,  // Use formData for the data
                contentType: false,  // Don't set content type to prevent jQuery from automatically processing it
                processData: false,  // Don't process the data
                dataType: 'json',
                success: function (data) {
                    // Handle the AJAX response and update the UI
                    $("#loading-message").hide();

                    if (data.similar_fish) {
                        // Display similar fish
                        $("#similar-fish-list").empty();
                        $.each(data.similar_fish, function (index, fish) {
                            $("#similar-fish-list").append("<li>" + fish + "</li>");
                        });
                        $("#similar-fish-section").show();
                    } else if (data.image_predicted_answer) {
                        // Display image predicted answer
                        // $("#image-predicted-answer-section").html("<p>" + data.image_predicted_answer + "</p>");
                        $("#img_predicted-answer-label").text(data.image_predicted_answer);
                        console.log("Image Path:", data.temp_image_path);
                        $("#predicted-image").attr("src", data.static_path + 'ml/temp_image.png');
                        $("#image-predicted-answer-section").show();
                    } else if (data.predicted_answer) {
                        // Display predicted answer
                        $("#predicted-answer-label").text(data.predicted_answer);
                        $("#predicted-answer-section").show();
                    } else {
                        // Display no similarity message
                        $("#no-similarity-message").show();
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                    $("#loading-message").hide();
                    $("#no-similarity-message").show();
                }
            });
        });






                            $("#voice-button").click(function () {
        $("#loading-message, #similar-fish-section, #predicted-answer-section, #no-similarity-message").hide();
        $("#message").val(""); // Clear the text area

        // Trigger speech recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        var recognition = new SpeechRecognition();
        // recognition.lang = 'en-US';

        recognition.onresult = function (event) {
            var transcript = event.results[0][0].transcript;
            $("#message").val(transcript);

            // Manually submit the form after setting the transcript
            submitFormWithVoice();
        };

        // Update textarea during speech recognition
        recognition.onaudiostart = function (event) {
            $("#message").attr("placeholder", "Listening...");
        };

        recognition.onaudioend = function (event) {
            $("#message").attr("placeholder", ""); // Clear placeholder
        };

        recognition.onerror = function (event) {
            $("#message").attr("placeholder", "Error during recognition. Please try again.");
        };

        recognition.start();
    });

    // Function to submit the form after voice input
    function submitFormWithVoice() {
        var form = $("#question-form");

        // Display loading message
        $("#loading-message").show();
        $("#similar-fish-section, #predicted-answer-section, #no-similarity-message").hide();

        // Use AJAX to submit the form
        $.ajax({
            type: form.attr("method"),
            url: form.attr("action"),
            data: form.serialize(),
            dataType: 'json',
            success: function (data) {
                // Handle the AJAX response and update the UI
                $("#loading-message").hide();

                if (data.similar_fish) {
                    // Display similar fish
                    $("#similar-fish-list").empty();
                    $.each(data.similar_fish, function (index, fish) {
                        $("#similar-fish-list").append("<li>" + fish + "</li>");
                    });
                    $("#similar-fish-section").show();
                } else if (data.predicted_answer) {
                    // Display predicted answer
                    $("#predicted-answer-label").text(data.predicted_answer);
                    $("#predicted-answer-section").show();
                } else {
                    // Display no similarity message
                    $("#no-similarity-message").show();
                }
            },
            error: function (error) {
                console.log('Error:', error);
                $("#loading-message").hide();
                $("#no-similarity-message").show();
            }
        });
    }

                        });
                    </script>


                    <!-- <script>
                        // Use JavaScript to handle form submission and update the result
                        document.addEventListener('DOMContentLoaded', function () {
                            const form = document.querySelector('form');
                            const predictedAnswerLabel = document.getElementById('predicted-answer-label');

                            form.addEventListener('submit', function (event) {
                                event.preventDefault();

                                // Use Fetch API to submit the form asynchronously
                                fetch(form.action, {
                                    method: form.method,
                                    body: new FormData(form),
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Update the result label
                                        predictedAnswerLabel.textContent = data.predicted_answer;
                                    })
                                    .catch(error => console.error('Error:', error));
                            });
                        });
                    </script> -->





                </div>
                <div class="tab-pane fade" id="tab-pane-2">
                    <p>{{ prod_desc.instructions }}</p>
                </div>
                <div class="tab-pane fade" id="tab-pane-3">
                    <div class="row">
                        <div class="col-md-6">
                            <!-- <h4 class="mb-4">{{ reviews|length }} reviews for "{{ reviews.product.prod_name }}"</h4> -->
                            {% for review in reviews %}
                            <div class="media mb-4">
                                <!-- <img src="img/user.jpg" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;"> -->
                                <div class="media-body">
                                    <h6>{{ review.user.username }}<small> - <i>{{ review.created_at|date:"d M Y"}}</i></small></h6>
                                    <div class="d-flex mb-3">
                                        <div class="d-flex align-items-center justify-content-center mb-1">
                                            {% if review.rating == 5 %}
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            {% elif review.rating == 4 %}
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-secondary mr-1"></small>
                                            {% elif review.rating == 3 %}
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-success mr-1"></small>
                                            <small class="fa fa-star text-secondary mr-1"></small>
                                            <small class="fa fa-star text-secondary mr-1"></small>
                                            {% elif review.rating == 2 %}
                                            <small class="fa fa-star text-danger mr-1"></small>
                                            <small class="fa fa-star text-danger mr-1"></small>
                                            <small class="fa fa-star text-secondary mr-1"></small>
                                            <small class="fa fa-star text-secondary mr-1"></small>
                                            <small class="fa fa-star text-secondary mr-1"></small>
                                            {% elif review.rating <= 1 %} <small class="fa fa-star text-danger mr-1"></small>
                                                <small class="fa fa-star text-secondary mr-1"></small>
                                                <small class="fa fa-star text-secondary mr-1"></small>
                                                <small class="fa fa-star text-secondary mr-1"></small>
                                                <small class="fa fa-star text-secondary mr-1"></small>
                                                {% endif %}
                                                <!-- <small>({{ avg_rating }})</small> -->
                                        </div>
                
                                        <!-- <small class="pt-1">(99 Reviews)</small> -->
                
                                    </div>
                                    <div class="text-primary mb-2">

                                    </div>
                                    <p>{{ review.description }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <div class="col-md-6">
                            <h4 class="mb-4">Leave a review</h4>
                            <!-- <small>Your email address will not be published. Required fields are marked *</small> -->
                            <div class="d-flex my-3">


                                {% if user_has_purchased_product and not user_has_reviewed_product %}
                                <form method="POST" action="{% url 'submit_review' %}">
                                    {% csrf_token %}
                                    <input type="hidden" id="prod_id" name="prod_id" value="{{ products.prod_id }}"
                                        required>

                                    <p class="mb-0 mr-2">Your Rating * :</p>
                                    <div class="star-rating">
                                        <i class="far fa-star" data-rating="1"></i>
                                        <i class="far fa-star" data-rating="2"></i>
                                        <i class="far fa-star" data-rating="3"></i>
                                        <i class="far fa-star" data-rating="4"></i>
                                        <i class="far fa-star" data-rating="5"></i>
                                    </div>

                                    <input type="hidden" id="selected_rating" name="rating" value="0" required>

                                    <div class="form-group">
                                        <label for="message">Your Review *</label>
                                        <textarea id="message" name="description" cols="30" rows="5"
                                            class="form-control" required></textarea>
                                    </div>

                                    <div class="form-group mb-0">
                                        <input type="submit" value="Leave Your Review" class="btn btn-primary px-3">
                                    </div>
                                </form>

                                {% else %}
                                <p>You can only leave a review if you have purchased this product  or you already made a response</p>
                                {% endif %}
                            </div>




                            <script>
                                $(document).ready(function () {
                                    // Initialize the rating to 0 (no stars selected)
                                    let rating = 0;

                                    // Handle star clicks
                                    $('.star-rating i').click(function () {
                                        // Get the rating value from the data attribute
                                        const clickedRating = parseInt($(this).data('rating'));

                                        // Set the selected rating in the hidden input field
                                        $('#selected_rating').val(clickedRating);

                                        // Update the global rating variable
                                        rating = clickedRating;

                                        // Update star colors based on the rating
                                        $('.star-rating i').each(function () {
                                            const starRating = parseInt($(this).data('rating'));
                                            if (starRating <= rating) {
                                                $(this).removeClass('far').addClass('fas text-success'); // Change color to green for selected stars
                                            } else {
                                                $(this).removeClass('fas text-success').addClass('far'); // Change color to default for unselected stars
                                            }
                                        });
                                    });
                                });

                            </script>






                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Shop Detail End -->
{% endblock %}