{% extends 'user_prof.html' %}


{% block content %}
<head>
<style>
.red-border {
    background-color: red !important;
    color: white !important;
}
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    $('#sub_cat_name').on('input', function () {
        var subCatName = $(this).val().trim();
        if (subCatName) {
            $.ajax({
                url: '{% url "check-subcategory-exists" %}',
                data: { 'sub_cat_name': subCatName },
                dataType: 'json',
                success: function (data) {
                    if (data.exists) {
                        $('#subCatNameError').text('Subcategory name already exists');
                        $('#submitBtn').prop('disabled', true);
                        $('#submitBtn').addClass('red-border');
                    } else {
                        $('#subCatNameError').text('');
                        $('#submitBtn').prop('disabled', false);
                        $('#submitBtn').removeClass('red-border');
                    }
                }
            });
        } else {
            $('#subCatNameError').text('');
            $('#submitBtn').prop('disabled', false);
            $('#submitBtn').removeClass('red-border');
        }
    });
});

function validateImage(event) {
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
    const file = event.target.files[0];
    const errorElement = document.getElementById('subImageError'); // Fixing typo here

    if (file) {
        if (allowedTypes.includes(file.type)) {
            errorElement.textContent = ''; // Clear any previous error message
            document.getElementById('submitBtn').removeAttribute('disabled');
        } else {
            errorElement.textContent = 'Only JPEG, PNG, and GIF images are allowed.'; // Display error message
            document.getElementById('submitBtn').setAttribute('disabled', 'true');
        }
    }
}

</script>

</head>


<body>
    <h1>Add Subcategory</h1></br></br>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="categ_id">Category:</label>
        <select id="categ_id" name="categ_id">
            {% for category in categories %}
                <option value="{{ category.categ_id }}">{{ category.categ_name }}</option>
            {% endfor %}
        </select></br></br>

        <label for="sub_cat_name">Subcategory Name:</label>
        <input type="text" id="sub_cat_name" name="sub_cat_name"><br>
        <span style="color:red" id="subCatNameError" class="error"></span></br>

        <label for="subcat_image">Subcategory Image:</label>
        <input type="file" id="subcat_image" name="subcat_image" onchange="validateImage(event)" required><br></br>
        <span style="color:red" id="subImageError" class="error"></span></br>


        <button style="border-radius:5px" type="submit" id="submitBtn" disabled>Add Subcategory</button>
    </form>
</body>
    {% endblock%}
  